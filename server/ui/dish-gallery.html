# NOTE: Served with MIME text/html+skybridge and hydrated by the Apps SDK.
# It expects window.openai.structuredContent to contain { items: [...] } and
# uses window.openai.callTool("get_recipe", { recipe_id }) when a card is clicked.

"""
<!doctype html>
<html>
  <body style="font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 16px;">
    <h2 style="margin: 0 0 12px 0;">Dishes</h2>
    <div id="grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 12px;"></div>

    <script>
      const data = (window.openai && window.openai.structuredContent) || { items: [] };
      const grid = document.getElementById('grid');

      function card(item){
        const div = document.createElement('div');
        div.style.border = '1px solid #e5e7eb';
        div.style.borderRadius = '12px';
        div.style.padding = '10px';
        div.style.background = 'var(--bg, #fff)';
        div.style.boxShadow = '0 1px 2px rgba(0,0,0,0.04)';
        div.innerHTML = `
          <img src="${item.imageUrl}" alt="${item.title}" style="width:100%; height:130px; object-fit:cover; border-radius:8px;"/>
          <div style="margin-top:8px;">
            <div style="font-weight:600;">${item.title}</div>
            <div style="font-size:12px; opacity:0.8;">
              ${item.quickFacts.kcal} kcal â€¢ ${item.quickFacts.protein_g}g protein
            </div>
            <button id="btn" style="margin-top:6px; padding:6px 10px; border-radius:8px; border:1px solid #d1d5db; background:#f8fafc; cursor:pointer;">View recipe</button>
          </div>
        `;
        div.querySelector('#btn').onclick = () => {
          if (window.openai && window.openai.callTool) {
            window.openai.callTool('get_recipe', { recipe_id: item.id });
          }
        };
        return div;
      }

      (data.items || []).forEach(i => grid.appendChild(card(i)));
    </script>
  </body>
</html>
"""
