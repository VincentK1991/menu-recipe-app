<!doctype html>
<html>
  <body style="font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 16px;">
    <h2 style="margin: 0 0 12px 0;">My personal 123 Dishes</h2>
    <div id="grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 12px;"></div>

    <script>
    // Support both bridges; prefer globalProps.
    const props =
      (window.globalProps) ||
      (window.openai && window.openai.structuredContent) ||
      {};
    const data = props; // data.items expected below

    const grid = document.getElementById('grid');

    function card(item){
      const div = document.createElement('div');
      div.style.border = '1px solid #e5e7eb';
      div.style.borderRadius = '12px';
      div.style.padding = '10px';
      div.style.background = 'var(--bg, #fff)';
      div.style.boxShadow = '0 1px 2px rgba(0,0,0,0.04)';
      div.style.transition = 'transform 120ms ease, box-shadow 120ms ease';
      div.onmouseenter = () => { div.style.transform = 'translateY(-2px)'; div.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)'; };
      div.onmouseleave = () => { div.style.transform = ''; div.style.boxShadow = '0 1px 2px rgba(0,0,0,0.04)'; };

      div.innerHTML = `
        <img src="${item.imageUrl}" alt="${item.title}" style="width:100%; height:130px; object-fit:cover; border-radius:8px;"/>
        <div style="margin-top:8px;">
          <div style="font-weight:600; line-height:1.2;">${item.title}</div>
          <div style="font-size:12px; opacity:0.8; margin-top:2px;">
            ${item.quickFacts?.kcal ?? '—'} kcal • ${item.quickFacts?.protein_g ?? '—'}g protein
          </div>
          <div style="display:flex; gap:6px; margin-top:6px;">
            <button data-id="${item.id}" class="btn-outline">View recipe</button>
            <button data-id="${item.id}" class="btn-primary">Add</button>
          </div>
        </div>
      `;
      div.querySelector('.btn-outline').onclick = () => {
        window.openai?.callTool?.('get_recipe', { recipe_id: item.id });
      };
      div.querySelector('.btn-primary').onclick = () => {
        window.openai?.postMessage?.({ type: 'select', id: item.id });
      };
      return div;
    }

    // Simple styles for buttons
    const style = document.createElement('style');
    style.textContent = `
      .btn-outline { padding:6px 10px; border-radius:8px; border:1px solid #d1d5db; background:#f8fafc; cursor:pointer; }
      .btn-outline:hover { background:#eef2f7; }
      .btn-primary { padding:6px 10px; border-radius:8px; border:1px solid #0ea5e9; background:#e0f2fe; cursor:pointer; }
      .btn-primary:hover { background:#bae6fd; }
    `;
    document.head.appendChild(style);

    (data.items || []).forEach(i => grid.appendChild(card(i)));
    </script>
  </body>
</html>
